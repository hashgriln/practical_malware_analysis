# Практический анализ вредоносного ПО
## Анализ вредоносных программ для начинающих
#### Методики анализа вредоносного ПО
- статический анализ
- динамический анализ
#### Типы вредоносного ПО
- Бэкдор. Вредоносный код, который устанавливается на компьютер, чтобы открыть доступ злоумышленнику. Бэкдоры обычно позволяют подключиться к компьютеру с минимальной аутентификацией или вовсе без таковой и выполнить команды в локальной системе.
- Ботнет. Открывает злоумышленнику доступ к системе, чем похож на бэкдор, однако все компьютеры, зараженные одним ботнетом, получают одни и те же инструкции от единого управляющего сервера.
- Загрузчик. Зловред, единственной целью которого является загрузка другого вредоносного кода. Злоумышленники обычно устанавливают загрузчики при первом доступе к системе. Этот вредонос загрузит и установит дополнительные зараженные программы.
- Похититель информации. Вредоносное ПО, которое собирает информацию на компьютере жертвы и, как правило, отправляет ее злоумышленнику. В качестве примера можно привести программы, захватывающие хеши паролей, перехватчики и кейлогеры. Эти вредоносы обычно используются для получения доступа к учетным записям интернет-приложений, таких как электронная почта или интернет-банкинг.
- Программа запуска. Вредоносная программа, с помощью которой запускается другой зловредный код. Обычно в таких программах используются нетрадиционные методики запуска, позволяющие незаметно получить доступ к системе или повысить привилегии.
- Руткит. Вредоносная программа, скрывающая существование другого кода. Руткиты обычно применяются в сочетании с другими вредоносами, такими как бэкдоры, что позволяет им открыть злоумышленнику доступ к системе и усложнить обнаружение кода.
- Запугивающее ПО. Вредоносная программа, созданная для запугивания атакованного пользователя и склонения его к покупке чего-либо. Обычно имеет графический интерфейс, схожий с антивирусом или другим приложением, обеспечивающим безопасность. Она сообщает пользователю о наличии в его системе вредоносного кода и убеждает его в том, что единственным выходом из ситуации является покупка определенного «программного обеспечения», хотя на самом деле это лишь удалит саму запугивающую программу.
- Программа для рассылки спама. Вредонос, который заражает компьютер пользователя и затем с его помощью рассылает спам. Этот тип программ генерирует доход для злоумышленников, позволяя им продавать услуги по рассылке спама.
- Червь, вирус. Вредоносный код, который способен копировать себя и заражать другие компьютеры.
#### Общие правила анализа вредоносного ПО
- Во-первых, не слишком отвлекайтесь на детали.
- Во-вторых, не существует универсального подхода
- Наконец, помните, что анализ вредоносных программ — это игра в кошки-мышки.
## Часть 1. Базовый анализ
### Глава 1. Основные статические методики
#### Сканирование антивирусом: первый шаг
- Они в основном полагаются на базу данных известных участков кода (файловых сигнатур), а также выполняют поведенческий анализ и сопоставление по образцу (эвристический подход), чтобы распознавать подозрительные файлы.
- Разные антивирусы используют разные сигнатуры и эвристики, поэтому бывает полезно применить к одному и тому ж файлу сразу несколько из них.
www.virustotal.com
#### Хеширование: отпечатки пальцев злоумышленника
- Хеширование — это распространенный метод однозначной идентификации вредоносного ПО.
- Уникальный хеш, принадлежащий какому-то участку вредоноса, можно использовать следующим образом:
  в качестве маркера;
  поделиться им с другими аналитиками, чтобы помочь им распознать угрозу;
  поискать его в Интернете на случай, если он уже был идентифицирован ранее.
#### Поиск строк
#### Упакованное и обфусцированное вредоносное ПО
- Если при исследовании программы с помощью утилиты Strings обнаружится лишь несколько строк, это может значить, что она является обфусцированной или упакованной и, возможно, содержит вредоносный код.
- Упаковка файлов
![image](https://user-images.githubusercontent.com/41237821/187399443-61c67801-4306-4283-8c15-77287ca8817d.png)
- Обнаружение упаковщиков с помощью PEiD
#### Компонуемые библиотеки и функции
- Исследование динамически скомпонованных функций с помощью Dependency Walker
![image](https://user-images.githubusercontent.com/41237821/187487722-bd5ebf2a-139b-4e0e-8a56-1b94fa71b5c0.png)
![image](https://user-images.githubusercontent.com/41237821/187487768-dc9b31f3-b5f5-4d6a-a6c3-3d92c0026907.png)
#### Статический анализ на практике
- Если Virtual Size намного больше, чем Size of Raw Data, вы можете быть уверены, что раздел занимает больше места в памяти, чем на диске. Это часто является признаком упакованного кода, особенно в случае с разделом .text.
- Просмотр раздела с ресурсами с помощью утилиты Resource Hacker
### Глава 2. Анализ вредоносных программ в виртуальных машинах
### Глава 3. Основы динамического анализа
#### Песочница 
* Это механизм безопасности, предназначенный для выполнения подозрительных программ в защищенной среде без риска нанести вред «реальной» системе.
* Недостатки песочниц
#### Мониторинг с помощью Process Monitor
* Process Monitor (или procmon) — это усовершенствованный инструмент мониторинга для Windows, который позволяет отслеживать активность, относящуюся к реестру, файловой системе, сети, процессам и потокам.
#### Фильтрация в procmon
- Registry (Реестр). Анализируя операции с реестром, вы можете определить, как вредоносный код устанавливается в реестр.
- File system (Файловая система). Исследуя взаимодействие с файловой системой, можно получить список всех файлов, которые создаются вредоносом или используются им для хранения конфигурации.
- Process activity (Активность процессов). Изучение активности процессов поможет понять, создает ли вредонос дополнительные процессы.
- Network (Сеть). Изучив сетевые соединения, вы можете определить, какие порты прослушивает вредоносная программа.

#### Просмотр процессов с помощью Process Explorer
* Process Explorer — это бесплатный и очень эффективный диспетчер задач от компании Microsoft, который следует держать открытым во время динамического анализа. Он может предоставить ценные сведения о процессах, которые работают в системе в текущий момент.
С помощью Process Explorer можно получить список активных процессов, загружаемых ими DLL, различных свойств процессов и общую информацию о системе. Вы также можете использовать этот инструмент для завершения процессов, вывода пользователей из системы, запуска и проверки новых процессов.

#### Использование Dependency Walker
#### Анализ зараженных документов
* Необходимо задействовать уязвимый вариант программы для просмотра документов. На практике лучше всего прибегнуть к старой версии без последних заплаток, чтобы вредонос мог воспользоваться уязвимостью.
#### Сравнение снимков реестрас помощью Regshot
#### Симуляция сети
#### Использование ApateDNS
* Cамый быстрый способ просмотреть DNS-запросы, выполненные вредоносом.

#### Использование INetSim
* Он позволяет анализировать сетевую активность неизвестных вредоносных образцов путем эмуляции серверов, работающих по протоколам HTTP, HTTPS, FTP, IRC, DNS, SMTP и т. д.


## Часть II. Продвинутый статический анализ
### Глава 4. Ускоренный курс по ассемблеру для архитектуры x86
### Глава 5. IDA Pro
### Глава 6. Распознавание конструкций языка C в ассемблере
### Глава 7. Анализ вредоносных программ для Windows
## Часть III. Продвинутый динамический анализ
### Глава 8. Отладка
### Глава 9. OllyDbg
### Глава 10. Отладка ядра с помощью WinDbg
## Часть IV. Возможности вредоносного ПО
### Глава 11. Поведение вредоносных программ
### Глава 12. Скрытый запуск вредоносного ПО
### Глава 13. Кодирование данны
### Глава 14. Сетевые сигнатуры, нацеленные на вредоносное ПО
## Часть V. Противодействие обратному проектированию
### Глава 15. Антидизассемблирование
### Глава 16. Антиотладка
### Глава 17. Методы противодействия виртуальным машинам
### Глава 18. Упаковщики и распаковка
## Часть VI. Специальные темы
### Глава 19. Анализ кода командной оболочки
### Глава 20. Анализ кода на C++
### Глава 21. Шестидесятичетырехбитные вредоносные программы
